%
% author:	Ni Qingliang
% date:		2011-02-11
%
\startcomponent cpn-arch
\product fusion-splicer-SD

\chapter{软件架构}
软件总体架构如\reffig{fs_sw_arch} 所示，
由此图可以看出，本软件采用分层设计，从上至下依次为：
\startigBase
\item 「应用层」：此部分主要负责与用户的交互和配置管理；
\item 「业务层」：此部分主要负责实现熔接机相关的业务，比如熔接、加热等。
\item 「设备层」：此部分主要是对驱动层（系统调用）的封装，并将其重新组织成逻辑器件供上层使用，
比如高压板是由两部分组成，一是 GPIO 控制开关，一是可调电阻，驱动是两部分，而设备层将其封装在一起。
\item 驱动层：此部分主要是屏蔽底层硬件细节，同种设备向上层提供统一的接口。
\stopigBase

\input{fig/fs_sw_arch.tex}
\placefigure[force][fig:fs_sw_arch]{熔接机软件总体架构}
            {\FLOWchart[fs_sw_arch]}

\section{层次之间的交互}
在这四层架构中，只有「驱动层」运行在内核空间，其他三层都运行在用户空间。

「应用层」与「业务层」之间主要通过消息进行交互（实现时采用 socket）。
「业务层」与「设备层」之间通过 API 调用进行交互。
「设备层」与「驱动层」之间通过系统调用进行交互。
另外在使用输入设备时，如按键、鼠标等，「应用层」也会直接与「设备层」交互。

详细交互流程请参考《熔接机软件设计说明书——应用部分》。

\section{SOA 和 OO }
整个软件采用面向服务的体系架构（SOA），此架构的一个特点就是松耦合，
服务间的接口是中立的，我们的系统中，服务间都是通过 socket 消息进行交互，即消息是中立的，
不依赖于任何服务，不依赖于特定操作系统，也不依赖于特定编程语言。

「业务层」的每一项业务都提供的是一种服务，其实「应用层」也可以认为提供的是一项服务，
这样理解的话，「应用层」其实是「业务层」的一部分。

具体到单项服务本身，我们采用面向对象（OO）的方式实现，这在后续章节中会有所体现。

接下来的章节将介绍「业务层」的实现。

\stopcomponent
